<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>‡∏£‡∏µ‡∏ß‡∏¥‡∏ß‡∏≠‡∏≤‡∏à‡∏≤‡∏£‡∏¢‡πå |Tutoring</title>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <!-- Navbar -->
  <link rel="stylesheet" href="../CSS/navbar.css" />
  <!-- Page CSS (‡πÅ‡∏¢‡∏Å‡πÑ‡∏ü‡∏•‡πå) -->
  <link rel="stylesheet" href="../CSS/reviews.css" />
</head>
<body>
  <!-- NAVBAR -->
  <header class="cc-navbar" role="navigation" aria-label="‡∏´‡∏•‡∏±‡∏Å">
    <div class="cc-nav-wrap">
      <a class="cc-brand" href="/Home/Home.html" aria-label=">Tutoring ‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å">
        <span class="cc-logo" aria-hidden="true">‚¨¢</span>
        <strong class="cc-site">Tutoring</strong>
      </a>
      <ul class="cc-links">
        <li><a href="/Teacher/teacher.html">‡∏ï‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå</a></li>
        <li><a href="/Teacher/favorites.html">‡∏ñ‡∏π‡∏Å‡πÉ‡∏à‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô</a></li>
      </ul>
      <div class="cc-right">
        <a class="cc-icon" href="/Teacher/notifications.html" aria-label="‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô">
          <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M12 22a2 2 0 002-2H10a2 2 0 002 2zm6-6V11a6 6 0 10-12 0v5L4 18v1h16v-1l-2-2z"/></svg>
        </a>
        <a class="cc-avatar" href="/Profile/account.html" aria-label="‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô">
          <img src="https://i.pravatar.cc/36?img=68" alt="‡∏†‡∏≤‡∏û‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ">
        </a>
      </div>
    </div>
  </header>

  <!-- HERO: Tutor header -->
  <section class="section">
    <div class="container card tutor-head" id="tutorHead"></div>
  </section>

  <!-- SUMMARY -->
  <section class="section">
    <div class="container card">
      <div class="row" style="justify-content:space-between;align-items:flex-start">
        <div>
          <h2 class="h1" style="margin:0 0 .75rem">‡∏£‡∏µ‡∏ß‡∏¥‡∏ß‡∏à‡∏≤‡∏Å‡∏ú‡∏π‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h2>
          <div class="muted">‡∏≠‡πà‡∏≤‡∏ô‡∏õ‡∏£‡∏∞‡∏™‡∏ö‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏à‡∏£‡∏¥‡∏á‡∏à‡∏≤‡∏Å‡∏ú‡∏π‡πâ‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏Å‡∏±‡∏ö‡∏≠‡∏≤‡∏à‡∏≤‡∏£‡∏¢‡πå‡∏ó‡πà‡∏≤‡∏ô‡∏ô‡∏µ‡πâ</div>
        </div>
        <div class="row">
          <button id="btnWrite" class="btn primary">‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏£‡∏µ‡∏ß‡∏¥‡∏ß</button>
        </div>
      </div>

      <div class="summary" style="margin-top:1rem">
        <div class="score-big">
          <div class="num" id="avgNum">0.0</div>
          <div class="stars" id="avgStars"></div>
          <div class="muted"><span id="countReviews">0</span> ‡∏£‡∏µ‡∏ß‡∏¥‡∏ß</div>
        </div>
        <div class="break" id="breakWrap"></div>
      </div>
    </div>
  </section>

  <!-- FILTER BAR -->
  <section class="section">
    <div class="container card">
      <div class="toolbar">
        <button class="tab active" data-filter="all">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
        <button class="tab" data-filter="photo">‡∏°‡∏µ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</button>
        <button class="tab" data-filter="5">5 ‡∏î‡∏≤‡∏ß</button>
        <button class="tab" data-filter="4">4 ‡∏î‡∏≤‡∏ß</button>
        <button class="tab" data-filter="3">‚â§ 3 ‡∏î‡∏≤‡∏ß</button>
        <div class="spacer"></div>
        <select id="sortMode" aria-label="‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏≥‡∏î‡∏±‡∏ö">
          <option value="new">‡πÉ‡∏´‡∏°‡πà‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</option>
          <option value="top">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î</option>
          <option value="low">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ï‡πà‡∏≥‡∏™‡∏∏‡∏î</option>
        </select>
        <input id="q" type="search" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÉ‡∏ô‡∏£‡∏µ‡∏ß‡∏¥‡∏ß‚Ä¶" />
      </div>
    </div>
  </section>

  <!-- REVIEW LIST -->
  <main class="section">
    <div class="container rev-list" id="revList" aria-live="polite"></div>
  </main>

  <!-- EMPTY TEMPLATE -->
  <template id="tpl-empty">
    <div class="container">
      <div class="empty">
        <div style="font-size:2rem">üìù</div>
        <h3 class="h1" style="font-size:1.2rem">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏µ‡∏ß‡∏¥‡∏ß</h3>
        <div class="muted">‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏ô‡πÅ‡∏£‡∏Å‡∏ó‡∏µ‡πà‡πÄ‡∏•‡πà‡∏≤‡∏õ‡∏£‡∏∞‡∏™‡∏ö‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</div>
        <div style="margin-top:.75rem">
          <button id="btnWriteEmpty" class="btn primary">‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏£‡∏µ‡∏ß‡∏¥‡∏ß</button>
        </div>
      </div>
    </div>
  </template>

  <!-- WRITE MODAL -->
  <div class="overlay" id="ovl">
    <div class="modal">
      <div class="row" style="margin-bottom:.5rem">
        <h3 class="h1" style="font-size:1.3rem">‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏£‡∏µ‡∏ß‡∏¥‡∏ß</h3>
        <button id="btnClose" class="btn ghost">‡∏õ‡∏¥‡∏î</button>
      </div>

      <div class="row">
        <div>‡πÉ‡∏´‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</div>
        <div class="stars-input" id="starInput" aria-label="‡πÉ‡∏´‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏î‡∏≤‡∏ß"></div>
      </div>

      <label class="muted" style="display:block;margin-top:.75rem">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏´‡πá‡∏ô</label>
      <textarea id="txtBody" placeholder="‡πÄ‡∏•‡πà‡∏≤‡∏õ‡∏£‡∏∞‡∏™‡∏ö‡∏Å‡∏≤‡∏£‡∏ì‡πå‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‚Ä¶"></textarea>

      <div class="row" style="margin-top:.75rem">
        <div class="row" style="gap:.5rem">
          <input type="file" id="imgPick" accept="image/*" multiple />
          <label><input type="checkbox" id="anon" /> ‡∏£‡∏µ‡∏ß‡∏¥‡∏ß‡πÅ‡∏ö‡∏ö‡πÑ‡∏°‡πà‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏ú‡∏¢‡∏ä‡∏∑‡πà‡∏≠</label>
        </div>
        <div class="spacer"></div>
        <button id="btnSubmit" class="btn primary">‡∏™‡πà‡∏á‡∏£‡∏µ‡∏ß‡∏¥‡∏ß</button>
      </div>
    </div>
  </div>

  <!-- FOOTER -->
  <footer class="site-footer">
    <div class="footer-inner container" style="padding:1.5rem 0">
      ¬© 2025 CodeClass ¬∑ ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡∏Å‡∏±‡∏ö‡∏≠‡∏≤‡∏à‡∏≤‡∏£‡∏¢‡πå‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡∏ó‡∏±‡πà‡∏ß‡πÇ‡∏•‡∏Å
    </div>
  </footer>

  <!-- Navbar badges -->
  <script src="navbar.js" defer></script>

  <!-- Page Logic (‡∏¢‡∏±‡∏á‡∏Ñ‡∏á‡∏£‡∏ß‡∏°‡πÑ‡∏ß‡πâ‡πÉ‡∏ô HTML ‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏Ç‡∏≠‡πÅ‡∏¢‡∏Å‡πÄ‡∏â‡∏û‡∏≤‡∏∞ CSS) -->
  <script>
  (function(){
    'use strict';
    const $  = s => document.querySelector(s);
    const $$ = s => Array.from(document.querySelectorAll(s));

    const url = new URL(location.href);
    const teacherId = (url.searchParams.get('id') || 'aree').toLowerCase();

    const Profiles = {
      aree:     { name:'‡∏≠‡∏≤‡∏£‡∏µ ‡πÉ‡∏à‡∏î‡∏µ',    subject:'‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©', price:550, avatar:'https://i.pinimg.com/736x/9c/e0/6d/9ce06dc2b0b6894de29fb110f2f28d71.jpg', tags:'‡πÅ‡∏Å‡∏£‡∏°‡∏°‡πà‡∏≤ ‡∏™‡∏ô‡∏ó‡∏ô‡∏≤' },
      prasit:   { name:'‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå ‡∏ï‡∏±‡πâ‡∏á‡πÉ‡∏à‡∏î‡∏µ', subject:'‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå', price:600, avatar:'https://i.pravatar.cc/120?img=65', tags:'‡∏û‡∏µ‡∏ä‡∏Ñ‡∏ì‡∏¥‡∏ï ‡πÄ‡∏£‡∏Ç‡∏≤‡∏Ñ‡∏ì‡∏¥‡∏ï PAT1' },
      somchai:  { name:'‡∏™‡∏°‡∏ä‡∏≤‡∏¢ ‡πÉ‡∏ù‡πà‡∏£‡∏π‡πâ', subject:'‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå', price:530, avatar:'https://i.pravatar.cc/120?img=13', tags:'‡∏ü‡∏¥‡∏™‡∏¥‡∏Å‡∏™‡πå ‡πÄ‡∏Ñ‡∏°‡∏µ ‡∏ä‡∏µ‡∏ß‡∏∞' },
      somsri:   { name:'‡∏™‡∏°‡∏®‡∏£‡∏µ ‡∏°‡∏µ‡∏´‡∏ß‡∏±‡∏á', subject:'‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢', price:490, avatar:'https://i.pravatar.cc/120?img=32', tags:'‡∏≠‡πà‡∏≤‡∏ô ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå' },
      peerapon: { name:'‡∏û‡∏µ‡∏£‡∏∞‡∏û‡∏• ‡∏£‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô', subject:'‡∏™‡∏±‡∏á‡∏Ñ‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤', price:520, avatar:'https://i.pravatar.cc/120?img=52', tags:'‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå ‡∏†‡∏π‡∏°‡∏¥‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå ‡∏û‡∏•‡πÄ‡∏°‡∏∑‡∏≠‡∏á' },
      tawan:    { name:'‡∏ï‡∏∞‡∏ß‡∏±‡∏ô ‡πÅ‡∏™‡∏á‡∏î‡∏µ',  subject:'‡∏®‡∏¥‡∏•‡∏õ‡∏∞', price:570, avatar:'https://i.pravatar.cc/120?img=48', tags:'‡∏ß‡∏≤‡∏î‡πÄ‡∏™‡πâ‡∏ô ‡∏£‡∏∞‡∏ö‡∏≤‡∏¢‡∏™‡∏µ ‡∏û‡∏≠‡∏£‡πå‡∏ï‡πÇ‡∏ü‡∏•‡∏¥‡πÇ‡∏≠' }
    };

    function getProfileFromFav(id){
      try{
        const favs = JSON.parse(localStorage.getItem('favorites.items')||'[]');
        const hit  = favs.find(x => (x.id||'').toLowerCase()===id || (x.href||'').toLowerCase().includes(id));
        if(!hit) return null;
        return {
          name:hit.title || Profiles[id]?.name,
          subject: hit.subject || Profiles[id]?.subject,
          price: parseInt(hit.price||Profiles[id]?.price||0,10),
          avatar: hit.avatar || Profiles[id]?.avatar,
          tags: hit.tags || Profiles[id]?.tags
        };
      }catch{ return null; }
    }
    const Profile = getProfileFromFav(teacherId) || Profiles[teacherId] || Profiles['aree'];

    const REV_KEY = `reviews.${teacherId}`;
    function loadReviews(){ try{ return JSON.parse(localStorage.getItem(REV_KEY))||[]; }catch{ return []; } }
    function saveReviews(items){ localStorage.setItem(REV_KEY, JSON.stringify(items)); }

    (function seed(){
      const cur = loadReviews();
      if(cur.length) return;
      const now = Date.now();
      saveReviews([
        {id:'r1', name:'Nong Mint', avatar:'https://i.pravatar.cc/80?img=12', star:5, body:'‡∏™‡∏≠‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏á‡πà‡∏≤‡∏¢‡∏°‡∏≤‡∏Å ‡∏™‡∏≥‡πÄ‡∏ô‡∏µ‡∏¢‡∏á‡∏ä‡∏±‡∏î ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏Å‡∏•‡πâ‡∏≤‡∏û‡∏π‡∏î‡∏Ç‡∏∂‡πâ‡∏ô‡πÄ‡∏¢‡∏≠‡∏∞‡πÄ‡∏•‡∏¢‡∏Ñ‡πà‡∏∞', time: new Date(now-60*60*1000).toISOString(), photos:[], liked:3},
        {id:'r2', name:'Poom', avatar:'https://i.pravatar.cc/80?img=20', star:4, body:'‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏ö‡πâ‡∏≤‡∏ô‡πÉ‡∏´‡πâ‡∏ù‡∏∂‡∏Å‡∏ï‡πà‡∏≠‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á ‡πÇ‡∏ü‡∏Å‡∏±‡∏™‡∏à‡∏∏‡∏î‡∏≠‡πà‡∏≠‡∏ô‡∏î‡∏µ‡∏Ñ‡∏£‡∏±‡∏ö', time: new Date(now-2*24*60*60*1000).toISOString(), photos:[], liked:1},
        {id:'r3', name:'‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠', avatar:'', star:3, body:'‡∏î‡∏µ‡∏Ñ‡πà‡∏∞ ‡πÅ‡∏ï‡πà‡∏ö‡∏≤‡∏á‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏£‡πá‡∏ß‡πÑ‡∏õ‡∏ô‡∏¥‡∏î ‡∏ñ‡πâ‡∏≤‡∏ä‡πâ‡∏≤‡∏•‡∏á‡∏≠‡∏µ‡∏Å‡∏´‡∏ô‡πà‡∏≠‡∏¢‡∏à‡∏∞‡∏î‡∏µ‡∏°‡∏≤‡∏Å', time: new Date(now-5*24*60*60*1000).toISOString(), photos:[], liked:0}
      ]);
    })();

    function starHTML(n){ return `<span class="star">${'‚òÖ'.repeat(n)}</span><span class="star" style="color:#cfd8ea">${'‚òÜ'.repeat(5-n)}</span>`; }
    function relTime(iso){
      const d = new Date(iso), sec = (Date.now()-d)/1000;
      if(sec<60) return '‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà';
      const m=Math.floor(sec/60); if(m<60) return m+' ‡∏ô‡∏≤‡∏ó‡∏µ‡∏ó‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß';
      const h=Math.floor(m/60); if(h<24) return h+' ‡∏ä‡∏°.‡∏ó‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß';
      const dd=Math.floor(h/24); if(dd===1) return '‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ß‡∏≤‡∏ô'; if(dd<=7) return dd+' ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß';
      return d.toLocaleDateString('th-TH');
    }
    function escapeHTML(s){ return (s||'').replace(/[&<>"']/g, m=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[m])); }

    function tutorHead(){
      $('#tutorHead').innerHTML = `
        <img class="tutor-avatar" src="${Profile.avatar||''}" alt="‡∏£‡∏π‡∏õ‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå">
        <div class="tutor-meta">
          <div class="h1">${Profile.name||'‡∏≠‡∏≤‡∏à‡∏≤‡∏£‡∏¢‡πå'}</div>
          <div class="chips">
            <span class="badge">${Profile.subject||''}</span>
            ${Profile.tags ? Profile.tags.split(/[, ]+/).filter(Boolean).slice(0,3).map(t=>`<span class="chip">#${t}</span>`).join('') : ''}
          </div>
          <div class="price">${(Profile.price||0).toLocaleString('th-TH')} ‡∏ö‡∏≤‡∏ó <small>/ 1 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á</small></div>
        </div>
        <div class="row" style="gap:.5rem">
          <a class="btn ghost" href="profile-${teacherId}.html">‡∏î‡∏π‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå</a>
        </div>
      `;
    }

    const avgNum = $('#avgNum'), avgStars = $('#avgStars'), countReviews = $('#countReviews'), breakWrap = $('#breakWrap');
    function calcSummary(list){
      const total=list.length, sum=list.reduce((a,b)=>a+b.star,0);
      const avg= total? Math.round((sum/total)*10)/10 : 0, buckets=[0,0,0,0,0];
      list.forEach(r=>buckets[r.star-1]++);
      return {total,avg,buckets};
    }
    function renderSummary(){
      const list=loadReviews(); const {total,avg,buckets}=calcSummary(list);
      avgNum.textContent=avg.toFixed(1); avgStars.innerHTML=starHTML(Math.round(avg)); countReviews.textContent=total; breakWrap.innerHTML='';
      for(let star=5; star>=1; star--){
        const count=buckets[star-1], pct= total? Math.round(count*100/total):0;
        const row=document.createElement('div'); row.className='bar';
        row.innerHTML=`<span class="pill" style="min-width:48px;text-align:center">${star} ‡∏î‡∏≤‡∏ß</span>
          <div class="track"><div class="fill" style="width:${pct}%"></div></div>
          <span class="muted" style="min-width:36px;text-align:right">${count}</span>`;
        breakWrap.appendChild(row);
      }
    }

    const revList = $('#revList'), sortMode=$('#sortMode'), tabs=$$('.tab'), q=$('#q');
    let currentFilter='all';
    function matchFilter(r){
      if(currentFilter==='all') return true;
      if(currentFilter==='photo') return (r.photos&&r.photos.length);
      if(currentFilter==='5') return r.star===5;
      if(currentFilter==='4') return r.star===4;
      if(currentFilter==='3') return r.star<=3;
      return true;
    }
    function sortBy(list,mode){
      const cp=list.slice();
      if(mode==='new') cp.sort((a,b)=> new Date(b.time)-new Date(a.time));
      else if(mode==='top') cp.sort((a,b)=> b.star-a.star);
      else if(mode==='low') cp.sort((a,b)=> a.star-b.star);
      return cp;
    }
    function renderList(){
      const all=loadReviews();
      const filtered = sortBy(all.filter(r=>matchFilter(r))
        .filter(r=> !q.value || (r.body||'').toLowerCase().includes(q.value.toLowerCase())), sortMode.value);

      if(!filtered.length){
        revList.innerHTML = document.querySelector('#tpl-empty').innerHTML;
        document.getElementById('btnWriteEmpty')?.addEventListener('click', openModal);
        return;
      }
      revList.innerHTML='';
      filtered.forEach(r=>{
        const node=document.createElement('article'); node.className='rev';
        node.innerHTML=`
          <div><img class="avatar" src="${r.avatar||'https://i.pravatar.cc/80?u=anon'}" alt=""></div>
          <div>
            <div class="row" style="align-items:baseline">
              <div class="name">${r.name||'‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠'}</div>
              <div class="stars">${starHTML(r.star)}</div>
              <div class="pill time">${relTime(r.time)}</div>
            </div>
            <div class="body">${escapeHTML(r.body||'')}</div>
            ${(r.photos && r.photos.length)
  ? `<div class="photos">${
       r.photos
        .filter(Boolean) // ‡∏Å‡∏±‡∏ô‡πÄ‡∏Ñ‡∏™‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô "" ‡∏´‡∏£‡∏∑‡∏≠ null
        .map(p => `<img src="${p}" loading="lazy" referrerpolicy="no-referrer"
                     onerror="this.remove()">`)
        .join('')
     }</div>`
  : ''
}

          </div>
          <div class="actions">
            <button class="btn ghost" aria-label="‡∏ñ‡∏π‡∏Å‡πÉ‡∏à‡∏£‡∏µ‡∏ß‡∏¥‡∏ß‡∏ô‡∏µ‡πâ">üëç ${r.liked||0}</button>
          </div>
        `;
        node.querySelector('.actions .btn')?.addEventListener('click', ()=>{
          const all=loadReviews(); const i=all.findIndex(x=>x.id===r.id);
          if(i>=0){ all[i].liked=(all[i].liked||0)+1; saveReviews(all); renderList(); }
        });
        revList.appendChild(node);
      });
    }

    const ovl=$('#ovl'), starInput=$('#starInput'), txtBody=$('#txtBody'), imgPick=$('#imgPick'), anon=$('#anon');
    function openModal(){ ovl.style.display='flex'; }
    function closeModal(){ ovl.style.display='none'; resetForm(); }
    function resetForm(){ txtBody.value=''; anon.checked=false; imgPick.value=null; pickStar(5); }
    function pickStar(n){
      starInput.innerHTML=''; starInput.dataset.value=n;
      for(let i=1;i<=5;i++){ const b=document.createElement('button'); b.type='button'; b.textContent='‚òÖ'; b.className=i<=n?'on':''; b.addEventListener('click',()=>pickStar(i)); starInput.appendChild(b); }
    }
    pickStar(5);
    $('#btnWrite').addEventListener('click', openModal);
    $('#btnClose').addEventListener('click', closeModal);
    $('#btnSubmit').addEventListener('click', ()=>{
      const star=parseInt(starInput.dataset.value||'0',10), body=txtBody.value.trim();
      if(!star){ alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏´‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô'); return; }
      if(!body){ alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏´‡πá‡∏ô'); return; }
      const files=Array.from(imgPick.files||[]);
      const readers=files.slice(0,4).map(f=> new Promise(res=>{ const fr=new FileReader(); fr.onload=e=>res(e.target.result); fr.readAsDataURL(f); }));
      Promise.all(readers).then(photos=>{
        const all=loadReviews();
        all.unshift({id:'r'+Date.now(), name: anon.checked?'‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠':'‡∏ú‡∏π‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô', avatar: anon.checked?'':'https://i.pravatar.cc/80?u=me', star, body, photos, time:new Date().toISOString(), liked:0});
        saveReviews(all); closeModal(); renderSummary(); renderList();
      });
    });

    tabs.forEach(t=>t.addEventListener('click',()=>{ tabs.forEach(x=>x.classList.remove('active')); t.classList.add('active'); currentFilter=t.dataset.filter; renderList(); }));
    $('#sortMode').addEventListener('change', renderList);
    $('#q').addEventListener('input', renderList);

    tutorHead(); renderSummary(); renderList();
  })();
  </script>
<script>
  // ‡∏≠‡πà‡∏≤‡∏ô‡∏Ñ‡πà‡∏≤‡∏û‡∏≤‡∏£‡∏≤‡∏°‡∏¥‡πÄ‡∏ï‡∏≠‡∏£‡πå id ‡∏à‡∏≤‡∏Å URL ‡πÄ‡∏ä‡πà‡∏ô ?id=aree
  const params = new URLSearchParams(location.search);
  const teacherId = params.get('id') || 'aree';

  // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏õ‡∏∏‡πà‡∏° "‡∏î‡∏π‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå"
  const profileBtn = document.querySelector('.btn.ghost');
  if (profileBtn) {
    profileBtn.href = `/Teacher/profile-${teacherId}.html`;
  }

  // ‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏° mapping ‡∏≠‡∏≤‡∏à‡∏≤‡∏£‡∏¢‡πå‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏£‡∏π‡∏õ
  const teacherData = {
    aree: {
      name: '‡∏≠‡∏≤‡∏£‡∏µ ‡πÉ‡∏à‡∏î‡∏µ',
      subject: '‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©',
      tags: ['‡πÅ‡∏Å‡∏£‡∏°‡∏°‡πà‡∏≤', '‡∏™‡∏ô‡∏ó‡∏ô‡∏≤'],
      price: 550,
      avatar: '/Teacher/images/aree.jpg'
    },
    peerapon: {
      name: '‡∏û‡∏µ‡∏£‡∏û‡∏• ‡∏û‡∏±‡∏í‡∏ô‡πå‡∏î‡∏µ',
      subject: '‡∏™‡∏±‡∏á‡∏Ñ‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤',
      tags: ['‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå', '‡∏†‡∏π‡∏°‡∏¥‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå'],
      price: 500,
      avatar: '/Teacher/images/peerapon.jpg'
    },
    prasit: {
      name: '‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå ‡πÄ‡∏Å‡πà‡∏á‡∏î‡∏µ',
      subject: '‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå',
      tags: ['‡∏û‡∏µ‡∏ä‡∏Ñ‡∏ì‡∏¥‡∏ï', '‡πÄ‡∏£‡∏Ç‡∏≤‡∏Ñ‡∏ì‡∏¥‡∏ï'],
      price: 580,
      avatar: '/Teacher/images/prasit.jpg'
    },
    somchai: {
      name: '‡∏™‡∏°‡∏ä‡∏≤‡∏¢ ‡∏°‡∏µ‡πÉ‡∏à',
      subject: '‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå',
      tags: ['‡∏ü‡∏¥‡∏™‡∏¥‡∏Å‡∏™‡πå', '‡πÄ‡∏Ñ‡∏°‡∏µ'],
      price: 600,
      avatar: '/Teacher/images/somchai.jpg'
    },
    somsri: {
      name: '‡∏™‡∏°‡∏®‡∏£‡∏µ ‡∏°‡∏µ‡∏´‡∏ß‡∏±‡∏á',
      subject: '‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢',
      tags: ['‡∏≠‡πà‡∏≤‡∏ô', '‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô', '‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå'],
      price: 530,
      avatar: '/Teacher/images/somsri.jpg'
    },
    tawan: {
      name: '‡∏ï‡∏∞‡∏ß‡∏±‡∏ô ‡πÅ‡∏™‡∏á‡∏î‡∏µ',
      subject: '‡∏®‡∏¥‡∏•‡∏õ‡∏∞',
      tags: ['‡∏ß‡∏≤‡∏î‡πÄ‡∏™‡πâ‡∏ô', '‡∏û‡∏≠‡∏£‡πå‡∏ï‡πÇ‡∏ü‡∏•‡∏¥‡πÇ‡∏≠'],
      price: 570,
      avatar: '/Teacher/images/tawan.jpg'
    }
  };

  const info = teacherData[teacherId];
  if (info) {
    document.querySelector('.teacher-card h2').textContent = info.name;
    document.querySelector('.badge.lang').textContent = info.subject;
    document.querySelector('.price').innerHTML = `${info.price.toLocaleString('th-TH')} ‡∏ö‡∏≤‡∏ó <small>/ 1 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á</small>`;

    // ‚úÖ ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏£‡∏π‡∏õ‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå
    const avatarImg = document.querySelector('.teacher-card .avatar');
    if (avatarImg) avatarImg.src = info.avatar;

    // ‚úÖ ‡∏•‡πâ‡∏≤‡∏á‡πÅ‡∏ó‡πá‡∏Å‡πÄ‡∏Å‡πà‡∏≤‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà
    const tagWrap = document.querySelector('.tags');
    if (tagWrap) {
      tagWrap.querySelectorAll('.chip').forEach(c => c.remove());
      info.tags.forEach(tag => {
        const chip = document.createElement('span');
        chip.className = 'chip';
        chip.textContent = `#${tag}`;
        tagWrap.appendChild(chip);
      });
    }
  }
</script>
</body>
</html>
